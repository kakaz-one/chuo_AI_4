# 第8回 データサイエンスとデータベース

ver1.0.1  
最終更新日: 2022年11月14日

---

## 目次

1. 授業概要
2. SQL 授業の進め方
3. SQL とは
4. リレーショナルデータベース（RDB）とは
5. SQLite のダウンロードと設定
6. DB Browser for SQLite のダウンロードと設定
7. SQLite でできること・他のSQLとの差異

---

## 授業概要

### 目的と到達目標

**目的**
- 汎用的プログラミング言語の中で、データサイエンスにおける中心的な役割を演じている Python と、データベース言語 SQL の基礎を理解すること

**到達目標**
- Python を用いて数十行程度のプログラミングを読んで理解・修正できること、そして簡単なプログラムを自分で作成できること
- SQLite を用いてデータベースからのデータ抽出や基本的な処理を行えること

### 授業の全体像

前半は Python、後半は SQL を扱う。授業の内容は変更される場合がある。

**Python (第1回〜第7回)**
- 第1回 データサイエンスと Python
- 第2回 プログラミング入門
- 第3回 関数の基礎
- 第4回 条件分岐とループ
- 第5回 NumPy によるベクトル・行列演算
- 第6回 Matplotlib によるグラフ作成
- 第7回 pandas によるデータ分析の基礎
- 前半レポート

**SQL (第8回〜第14回)**
- 第8回 データサイエンスとデータベース
- 第9回 データベースの作成と接続、テーブル操作
- 第10回 データの抽出
- 第11回 テーブルの結合
- 第12回 データベースからのデータ抽出と集計
- 第13回 SQLite 関数の活用
- 第14回 Python と SQLite の連携
- 後半レポート

### できるようになる処理・分析

#### 1. 大規模データのハンドリング

**データベースを使わない場合**
- Excel や Access で扱えるデータの規模には限界がある
- Python や R などで大規模データを読み込むとメモリエラーになることがある

**データベースを使う場合**
- 大規模データをデータベースに格納すると、SQLによるデータの抽出・加工・集計が可能になる
- 抽出・加工・集計したデータをCSVなどに出力しておくことで、他のソフトでの分析が可能になる

#### 2. データベースからデータの収集

収集したデータを抽出・加工・集計を行いデータを整形しまとめ、ビジネスの現状・傾向・問題点を把握する。

**データの収集**
- データセットから分析用途に合わせたテーブルの取得

**データの前処理・基礎集計**
- 収集したデータの前処理を行う
- 生データを機械学習で活用できるデータに整形
- 整形したデータの基礎集計を行い、考察

**現状・傾向・課題の把握**
- 基礎集計で得られた知見をもとに、ビジネスの現状・傾向を把握する
- ビジネスの課題を発見・把握する

#### 3. 【発展】BIツールを使ったダッシュボード構築

Tableau、Metabase、QlikView、PentahoなどのBIツールで複雑な処理ができるようになる（ただし、本講座ではBIツールの使い方については扱わない）。

**データベースへの接続**
- ホスト、ポート、データベース名などを入力

**SQLを使用したダッシュボード構築**
- ドラッグ＆ドロップなど、GUIでの操作も可能
- 複雑な処理にはSQLが必要

**現状・傾向・課題の把握**
- グラフによって可視化することで、ビジネスの現状・傾向・課題を発見・把握しやすくなる

---

## SQL 授業の進め方

### 授業は配布資料 (PDF) と SQLite を使用して進める

- 配布資料を使った説明の後、SQLite で実際に動かす
- SQLite はコマンドラインツールとDB Browser for SQLite を使用する
- 各自で配布資料や動画を見ながら入力する時間を設けるため、各回の動画は60分程度を予定している
- 外付けのモニター等を使い、2つ以上の画面で受講することを推奨する

> ※ この授業に限らず、複数のモニターを使うと作業がはかどる

---

## SQL とは

### SQLとは、「データベースを操作するための言語」である

- **Structured Query Language** の略
- SQLで記載されたプログラムを **クエリ (=Query)** とも呼ぶ
  - クエリは「問い合わせ」と訳される

### SQLの主な用途

1. **データの抽出（加工・集計）**
2. データの追加
3. データの変更・削除

### 「データ分析」における使われ方

主に、データベースからのデータの抽出や集計を行う。
→ データを適切な形に抽出し、RやPythonで読み込む

### SQLの種類

SQLには大きく分けて3つの種類がある。授業では DML と DDL を扱う。

| 種類 | 役割 | 例 |
|------|------|-----|
| **データ操作言語 (DML: Data Manipulation Language)** | テーブル内のデータの選択、登録、更新、削除などを行う | SELECT(選択), INSERT(挿入), UPDATE(更新), DELETE(削除)など |
| **データ定義言語 (DDL: Data Definition Language)** | テーブルの表の作成、削除、設定の変更などを行う | CREATE(テーブル作成), DROP(テーブル削除)など |
| **データ制御言語 (DCL: Data Control Language)** | 上記二つの利用権限を付与、削除などを行う | GRANT(権限付与), REVOKE(権限削除)など |

---

## リレーショナルデータベース（RDB）とは

### データベースの概念

- 特定のテーマに沿ったデータを集めて管理し、容易に検索・抽出などの再利用をできるようにしたものである
- 狭義には、コンピュータによって実現されたものを指す
- 一般的に「データベース」といえば、**リレーショナル・データベース (RDB)** を指す

データベースとは複数のデータを詰め込める「入れ物」である。

データベースの種類：リレーショナルデータベース、オブジェクトデータベース、XMLデータベース など

### なぜデータベースを使うのか

**ローカル環境で扱うには大きすぎるデータを格納し、素早く加工・取り出しを行うことができる**

- 最新データを1箇所に集積しておくことで、複数のメンバーで共有することができる
- 表計算ソフトとDBの目的の違い
  - 表計算の目的は計算すること
  - DBは、常に最新の情報を一箇所に集めること
- データベースは「多くの物を整理して入れられるでかい箱（間仕切りあり）」というイメージ

### 知っておきたいツールの限界

ExcelやAccessをDBとして使うこともできるが、いわゆるビッグデータはExcelやAccessの使用想定を超えている。

**Excel**
| 項目 | 上限 |
|------|------|
| 最大行数 | 1,048,576 |
| 最大列数 | 16,384 |
| セル内の文字列の長さ | 32,767 |

**Access**
| 項目 | 上限 |
|------|------|
| データサイズ | 2 GB |
| クエリの結合数の上限 | 16 |
| 文字列の長さの上限 | 255 |

### データベース管理システムの例

データベースを管理するシステムを **リレーショナルデータベースマネジメントシステム（RDBMS）** と呼ぶ。

RDBMS には有償のものと無償のものがある。授業では無償の SQLite を使用する。

**商用ソフトウェア (有償)**
- Oracle Database
- IBM DB2
- Sybase IQ
- FileMaker
- Microsoft SQL Server
- Microsoft Access
- Excel

**オープンソース・ソフトウェア (無償)**
- Oracle Berkeley DB
- MySQL
- PostgreSQL
- MongoDB
- SQLite
- HyperSQL
- MariaDB

**クラウドベース**
- Amazon Redshift
- Microsoft Azure
- Google BigQuery

### RDBMSの構成

Oracle や PostgreSQL、Amazon Redshift などの RDBMS は、内部に「データベース」>「スキーマ」>「テーブル」という構造を持つ。

- 案件ごとにデータベースを作成し、データの種類に応じてスキーマを分ける運用がなされる
- **ただし、SQLite ではスキーマの機能はない**

**この構成を本屋に例えると・・・**
- **データベース**：フロア
- **スキーマ**：棚（出版社ごとに）
- **テーブル**：書籍情報（1レコード1冊）

### テーブル

テーブルとは、データベースの基礎となるものである。

- Excelと同じイメージ（表形式）でデータを格納する

### テーブルにおける用語

テーブルの中身について話をする際には、以下のような用語が使われる。それぞれの用語が何を意味するのかを覚えておく。

| 用語 | 説明 |
|------|------|
| **テーブル** | データを格納する表全体 |
| **カラム（列）** | 表の縦方向の項目 |
| **レコード（ロウ/行）** | 表の横方向のデータ1件分 |
| **フィールド** | カラムとレコードが交差する1つのセル |

---

## SQLite のダウンロードと設定

### SQLite のダウンロード

SQLite の公式サイトから、OS に合わせてダウンロードする。

- 公式サイト: https://www.sqlite.org/index.html
- 「Download」を選択し、OSに合わせてzipファイルをダウンロード

### SQLite の解凍

zip ファイルを解凍し、3つのファイルがあることを確認する。

- 解凍には 7-zip 等を利用する（7-Zip 以外の解凍ソフトを利用してもよい）
- 7-Zip: https://forest.watch.impress.co.jp/library/software/7zip/

**解凍後にできるexeファイル**
- sqldiff.exe
- sqlite3.exe
- sqlite3_analyzer.exe

### SQLite の移動

任意のフォルダに3つのファイルを移動する。

今回は、デスクトップに「sqlite3」というフォルダを作成して、そこに移動する。

エクスプローラーで操作してもよいが、コマンドプロンプトを使った作成方法：

1. タスクバーの「ここに入力して検索」に「cmd」と入力
2. コマンドプロンプトを選択
3. 以下のコードを実行

```bash
cd Desktop
mkdir sqlite3
```

4. 「sqlite3」フォルダに、3つのファイルを移動する

### 動作確認

SQLite が正しく動作するか確認する。

コマンドプロンプトを起動して以下のコードを実行し、エラーにならなければ正しく動作している。

```bash
cd Desktop
cd sqlite3
sqlite3.exe
```

sqlite の起動後（「sqlite> 」が左側に表示される）：

```sql
SELECT 1+1;
```

結果として `2` が表示されれば成功。

### SQLite の終了

`.exit` と入力してSQLite を終了する。

```
.exit
```

左側に表示されていた「sqlite> 」が消える。

---

## DB Browser for SQLite のダウンロードと設定

### DB Browser for SQLite のダウンロード

GUIベースの管理ツールとして DB Browser for SQLite がある。

- 公式サイトから OS に合わせてダウンロードする
- 公式サイト: https://sqlitebrowser.org/

### DB Browser for SQLite のインストール

ダウンロードしたファイルをダブルクリックしてインストールする。

基本的に「Next」を選択する。

1. 必要に応じて「location」を変更する（デフォルトのままでもよい）
2. ライセンス同意にチェックを入れる
3. ショートカットを作る場合はチェックを入れる（作らなくてもよい）
4. インストール先を確認し、Install を選択

※「この不明な発行元からのアプリがデバイスに変更を加えることを許可しますか」と表示された場合、「はい」を選択する

### 動作確認

DB Browser for SQLite.exe を実行する。

エクスプローラーで選択するか、コマンドプロンプトから実行する。

コマンドプロンプトで実行するには以下のコマンドを入力する：

```bash
cd ¥
cd Program Files¥DB Browser for SQLite
DB Browser for SQLite.exe
```

DB Browser for SQLite の画面が表示されれば正しく動作している。

---

## SQLite でできること・他の SQL との差異

### SQLite でできること

SQLite は RDBMS の基本的な機能を備えている。

- データベースの作成・削除、テーブルの作成・削除
- データの追加・変更・削除、データの抽出（加工・集計）

### 他の SQL との差異

SQLite を使用するにあたり、メリットとデメリットを把握しておく。

**メリット**
- 無償で利用可能
- 軽量
- 設定が不要
- 単一のファイルに保存される
- データ型の指定が不要

**デメリット**
- パスワードが設定できない
- 同時書き込みをするとロックされてしまうことがある
- （日本語の）情報が少ない

---

## 章末課題

**問題**: SQL を略さずに言った場合の名称を以下から選択せよ

1. Super Query Language
2. Super Queue Language
3. **Structured Query Language** ← 正解
4. Structured Queue Language

---

Copyright © 2023 Accenture. All rights reserved.